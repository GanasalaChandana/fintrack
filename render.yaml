services:
  # ML Classifier Service (Python)
  - type: web
    name: fintrack-ml-classifier
    env: python
    region: oregon
    plan: starter
    buildCommand: pip install -r ml-classifier/requirements.txt
    startCommand: cd ml-classifier && python main.py
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: 8000
      - key: PYTHON_VERSION
        value: 3.11

  # API Gateway (Spring Boot)
  - type: web
    name: fintrack-api-gateway
    env: docker
    dockerfilePath: ./backend/api-gateway/Dockerfile
    dockerContext: .
    region: oregon
    plan: starter
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: production
      - key: SERVER_PORT
        value: 8080
      - key: USERS_SERVICE_URL
        fromService:
          name: fintrack-users-service
          type: web
          property: host
      - key: TRANSACTIONS_SERVICE_URL
        fromService:
          name: fintrack-transactions-service
          type: web
          property: host
      - key: ALERTS_SERVICE_URL
        fromService:
          name: fintrack-alerts-service
          type: web
          property: host
      - key: REPORTS_SERVICE_URL
        fromService:
          name: fintrack-reports-service
          type: web
          property: host
      - key: ML_CLASSIFIER_URL
        fromService:
          name: fintrack-ml-classifier
          type: web
          property: host
      - key: SPRING_REDIS_HOST
        value: red-d3qmmdl6ubrc73834m80
      - key: SPRING_REDIS_PORT
        value: 6379

  # Users Service (Spring Boot)
  - type: web
    name: fintrack-users-service
    env: docker
    dockerfilePath: ./backend/users-service/Dockerfile
    dockerContext: .
    region: oregon
    plan: starter
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: production
      - key: SERVER_PORT
        value: 8081
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://dpg-d3qmi9c9c44c73csr6ug-a.oregon-postgres.render.com:5432/fintrack_user
      - key: SPRING_DATASOURCE_USERNAME
        value: fintrack_user
      - key: SPRING_DATASOURCE_PASSWORD
        sync: false  # Will be set manually in Render dashboard
      - key: SPRING_REDIS_HOST
        value: red-d3qmmdl6ubrc73834m80
      - key: SPRING_REDIS_PORT
        value: 6379
      - key: JWT_SECRET
        generateValue: true

  # Transactions Service (Spring Boot)
  - type: web
    name: fintrack-transactions-service
    env: docker
    dockerfilePath: ./backend/transactions-service/Dockerfile
    dockerContext: .
    region: oregon
    plan: starter
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: production
      - key: SERVER_PORT
        value: 8082
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://dpg-d3qmi9c9c44c73csr6ug-a.oregon-postgres.render.com:5432/fintrack_user
      - key: SPRING_DATASOURCE_USERNAME
        value: fintrack_user
      - key: SPRING_DATASOURCE_PASSWORD
        sync: false
      - key: SPRING_REDIS_HOST
        value: red-d3qmmdl6ubrc73834m80
      - key: SPRING_REDIS_PORT
        value: 6379
      - key: ML_CLASSIFIER_URL
        fromService:
          name: fintrack-ml-classifier
          type: web
          property: host
      - key: SPRING_KAFKA_BOOTSTRAP_SERVERS
        value: your-kafka-server:9092  # Update with your Kafka server

  # Alerts Service (Spring Boot)
  - type: web
    name: fintrack-alerts-service
    env: docker
    dockerfilePath: ./backend/alerts-service/Dockerfile
    dockerContext: .
    region: oregon
    plan: starter
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: production
      - key: SERVER_PORT
        value: 8083
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://dpg-d3qmi9c9c44c73csr6ug-a.oregon-postgres.render.com:5432/fintrack_user
      - key: SPRING_DATASOURCE_USERNAME
        value: fintrack_user
      - key: SPRING_DATASOURCE_PASSWORD
        sync: false
      - key: SPRING_REDIS_HOST
        value: red-d3qmmdl6ubrc73834m80
      - key: SPRING_REDIS_PORT
        value: 6379
      - key: SPRING_KAFKA_BOOTSTRAP_SERVERS
        value: your-kafka-server:9092

  # Reports Service (Spring Boot)
  - type: web
    name: fintrack-reports-service
    env: docker
    dockerfilePath: ./backend/reports-service/Dockerfile
    dockerContext: .
    region: oregon
    plan: starter
    healthCheckPath: /actuator/health
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: production
      - key: SERVER_PORT
        value: 8084
      - key: SPRING_DATASOURCE_URL
        value: jdbc:postgresql://dpg-d3qmi9c9c44c73csr6ug-a.oregon-postgres.render.com:5432/fintrack_user
      - key: SPRING_DATASOURCE_USERNAME
        value: fintrack_user
      - key: SPRING_DATASOURCE_PASSWORD
        sync: false
      - key: SPRING_REDIS_HOST
        value: red-d3qmmdl6ubrc73834m80
      - key: SPRING_REDIS_PORT
        value: 6379
      - key: SPRING_KAFKA_BOOTSTRAP_SERVERS
        value: your-kafka-server:9092
      - key: MANAGEMENT_ENDPOINTS_WEB_EXPOSURE_INCLUDE
        value: health,info,metrics,prometheus
      - key: MANAGEMENT_METRICS_EXPORT_PROMETHEUS_ENABLED
        value: true